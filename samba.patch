diff --git a/.gitignore b/.gitignore
index 1b307ca80d6..272c9a246b6 100644
--- a/.gitignore
+++ b/.gitignore
@@ -81,3 +81,4 @@ python/samba/provision/kerberos_implementation.py
 
 # read by direnv to auto load environment variables
 .envrc
+/Debug/
diff --git a/buildtools/wafsamba/samba_autoconf.py b/buildtools/wafsamba/samba_autoconf.py
index 8e5dfb87102..fad16f736b5 100644
--- a/buildtools/wafsamba/samba_autoconf.py
+++ b/buildtools/wafsamba/samba_autoconf.py
@@ -430,7 +430,7 @@ def CHECK_CODE(conf, code, define,
     conf.COMPOUND_START(msg)
 
     try:
-        ret = conf.check(fragment=fragment,
+        ret = conf.check(features='c cprogram',fragment=fragment,
                      execute=execute,
                      define_name = define,
                      cflags=cflags,
@@ -718,8 +718,8 @@ def SAMBA_CONFIG_H(conf, path=None):
                                 cflags=[ '-Werror', '-fstack-clash-protection'],
                                 mandatory=False,
                                 msg='Checking if compiler accepts -fstack-clash-protection')
-    if flag_supported:
-        conf.ADD_CFLAGS('-fstack-clash-protection')
+#    if flag_supported:
+#        conf.ADD_CFLAGS('-fstack-clash-protection')
 
     if Options.options.debug:
         conf.ADD_CFLAGS('-g', testflags=True)
diff --git a/buildtools/wafsamba/wafsamba.py b/buildtools/wafsamba/wafsamba.py
index cd3e9d3e7a8..90980a08a4d 100644
--- a/buildtools/wafsamba/wafsamba.py
+++ b/buildtools/wafsamba/wafsamba.py
@@ -104,6 +104,7 @@ def SAMBA_LIBRARY(bld, libname, source,
                   vnum=None,
                   soname=None,
                   cflags='',
+                  cxxflags='',
                   cflags_end=None,
                   ldflags='',
                   external_library=False,
@@ -369,7 +370,7 @@ def SAMBA_BINARY(bld, binname, source,
     if not SET_TARGET_TYPE(bld, binname, 'BINARY'):
         return
 
-    features = 'c cprogram symlink_bin install_bin'
+    features = 'cxx cxxprogram c cprogram symlink_bin install_bin'
     if pyembed:
         features += ' pyembed'
 
diff --git a/buildtools/wafsamba/wscript b/buildtools/wafsamba/wscript
index 8014716e64e..d188f7ca27e 100644
--- a/buildtools/wafsamba/wscript
+++ b/buildtools/wafsamba/wscript
@@ -25,6 +25,11 @@ def default_value(option, default=''):
 def options(opt):
     opt.load('compiler_cc')
 
+    #TW Add support for cpp
+    opt.load('compiler_cxx')
+    opt.load('boost')
+    #TW Add support for cpp
+    opt.load('cxx')
     opt.load('gnu_dirs')
 
     gr = opt.option_group('library handling options')
@@ -225,11 +230,15 @@ def configure(conf):
     # load our local waf extensions
     conf.load('gnu_dirs')
     conf.load('wafsamba')
+    conf.load('c_config')
 
     conf.CHECK_CC_ENV()
 
     conf.load('compiler_c')
+    conf.load('compiler_cxx')
+    conf.load('boost')
 
+    conf.load('cxx')
     conf.CHECK_STANDARD_LIBPATH()
 
     # we need git for 'waf dist'
diff --git a/wscript b/wscript
index 0557fa7070e..08a6cb69874 100644
--- a/wscript
+++ b/wscript
@@ -312,6 +312,7 @@ def configure(conf):
     conf.RECURSE('lib/socket')
     conf.RECURSE('lib/mscat')
     conf.RECURSE('packaging')
+    conf.RECURSE('trustwave')
 
     conf.SAMBA_CHECK_UNDEFINED_SYMBOL_FLAGS()
 
diff --git a/wscript_build b/wscript_build
index 771eb1fa0f7..79c61ea960b 100644
--- a/wscript_build
+++ b/wscript_build
@@ -150,6 +150,7 @@ bld.RECURSE('dfs_server')
 bld.RECURSE('file_server')
 bld.RECURSE('lib/krb5_wrap')
 bld.RECURSE('packaging')
+bld.RECURSE('trustwave')
 
 bld.RECURSE('testsuite/headers')
 
